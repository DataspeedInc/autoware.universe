<?xml version="1.0"?>
<launch>

    <arg name="pointcloud_map_loader_param_path" default="$(find-pkg-share map_loader)/config/pointcloud_map_loader.param.yaml"/>
    <arg name="lanelet2_map_loader_param_path" default="$(find-pkg-share map_loader)/config/lanelet2_map_loader.param.yaml"/>
    <arg name="lanelet2_map_path" default="/autoware_map/lanelet2_map.osm"/>
    <arg name="pcd_paths_or_directory" default="/autoware_map/pointcloud_map.pcd"/>
    <arg name="pcd_metadata_path" default=""/>
    <arg name="lanelet2_map_topic" default="vector_map"/>
    <arg name="lanelet2_map_marker_topic" default="vector_map_marker"/>

    <include file="$(find-pkg-share map_projection_loader)/launch/map_projection_loader.launch.xml">
        <arg name="map_projector_info_path" value="/autoware_map/map_projector_info.yaml" />
        <arg name="lanelet2_map_path" value="$(var lanelet2_map_path)" />
    </include>

    <node pkg="map_loader" exec="pointcloud_map_loader" name="pointcloud_map_loader" output="screen">
        <remap from="output/pointcloud_map" to="/map/pointcloud_map"/>
        <remap from="service/get_partial_pcd_map" to="/map/get_partial_pointcloud_map"/>
        <remap from="service/get_selected_pcd_map" to="/map/get_selected_pointcloud_map"/>
        <param from="$(var pointcloud_map_loader_param_path)" allow_substs="true"/>
    </node>

    <!-- <node pkg="map_loader" exec="map_hash_generator" name="map_hash_generator">
        <param from="$(var lanelet2_map_loader_param_path)" allow_substs="true"/>
    </node> -->

    <node pkg="map_loader" exec="lanelet2_map_loader" name="lanelet2_map_loader">
        <remap from="output/lanelet2_map" to="$(var lanelet2_map_topic)"/>
        <param from="$(var lanelet2_map_loader_param_path)" allow_substs="true"/>
    </node>

    <node pkg="map_loader" exec="lanelet2_map_visualization" name="lanelet2_map_visualization">
        <remap from="input/lanelet2_map" to="$(var lanelet2_map_topic)"/>
        <remap from="output/lanelet2_map_marker" to="$(var lanelet2_map_marker_topic)"/>
    </node>

    <arg name="map_tf_param_file" default="$(find-pkg-share map_tf_generator)/config/map_tf_generator.param.yaml"/>

    <node pkg="map_tf_generator" exec="pcd_map_tf_generator" name="pcd_map_tf_generator">
        <remap from="pointcloud_map" to="/map/pointcloud_map"/>
        <param from="$(var map_tf_param_file)"/>
        <param name="map_frame" value="map" />
    </node>
</launch>